"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var errors_js=require("./modules/errors.js"),utils=_interopDefault(require("./modules/utils.js")),monads=_interopDefault(require("./monads.js")),arrays=_interopDefault(require("./arrays.js")),events_js=require("./events.js"),conditional=_interopDefault(require("./conditional.js")),promise=_interopDefault(require("./promise.js")),isFunction=utils.isFunction,flatten=utils.flatten,_arrays=arrays(FP),map=_arrays.map,find=_arrays.find,findIndex=_arrays.findIndex,filter=_arrays.filter,flatMap=_arrays.flatMap,reduce=_arrays.reduce,_promise=promise(FP),all=_promise.all,reject=_promise.reject,delay=_promise.delay,_delay=_promise._delay,_conditional=conditional(FP),tapIf=_conditional.tapIf,thenIf=_conditional.thenIf,_thenIf=_conditional._thenIf,_monads=monads(FP),chain=_monads.chain,chainEnd=_monads.chainEnd;function resolve(r){return new FP(function(t,e){if(r&&isFunction(r.then))return r.then(t).catch(e);t(r)})}function promisify(o){var i=this;return function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new FP(function(r,n){return o.call.apply(o,[i].concat(e,[function(t,e){return t?n(t):r(e)}]))})}}function promisifyAll(e){if(!e||!Object.getPrototypeOf(e))throw new Error("Invalid Argument obj in promisifyAll(obj)");return Object.getOwnPropertyNames(e).filter(function(t){return"function"==typeof e[t]}).reduce(function(t,e){return/Sync/.test(e)||t[e+"Async"]||(t[e+"Async"]=FP.promisify(t[""+e])),t},e)}function unpack(){var r,n;return{promise:new FP(function(t,e){r=t,n=e}),resolve:r,reject:n}}function FP(t){if(!(this instanceof FP))return new FP(t);if(1!==arguments.length)throw new Error("FunctionalPromises constructor only accepts 1 callback argument");this._FP={errors:{limit:0,count:0},promise:new Promise(t),concurrencyLimit:4}}FP.prototype.all=all,FP.prototype.map=map,FP.prototype.find=find,FP.prototype.findIndex=findIndex,FP.prototype.filter=filter,FP.prototype.flatMap=flatMap,FP.prototype.reduce=reduce,FP.prototype.listen=events_js.listen,FP.prototype.tapIf=tapIf,FP.prototype.thenIf=thenIf,FP.prototype._thenIf=_thenIf,FP.prototype.delay=delay,FP.prototype._delay=_delay,FP.prototype.reject=reject,FP.all=FP.prototype.all,FP.thenIf=FP.prototype._thenIf,FP.delay=function(t){return FP.resolve().delay(t)},FP.silent=function(t){return FP.resolve().silent(t)},FP.chain=chain,FP.prototype.chainEnd=chainEnd,FP.reject=FP.prototype.reject,FP.resolve=resolve,FP.promisify=promisify,FP.promisifyAll=promisifyAll,FP.unpack=unpack,FP.prototype.addStep=function(t,e){return this.steps&&this.steps.push([t,this,e]),this},FP.prototype.concurrency=function(t){return void 0===t&&(t=1/0),this.steps?this.addStep("concurrency",Array.prototype.slice.call(arguments)):(this._FP.concurrencyLimit=t,this)},FP.prototype.quiet=function(t){return void 0===t&&(t=1/0),this.steps?this.addStep("quiet",Array.prototype.slice.call(arguments)):(this._FP.errors={count:0,limit:t},this)},FP.prototype.silent=FP.prototype.quiet,FP.prototype.get=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.steps?this.addStep("get",Array.prototype.slice.call(arguments)):(e=flatten(e),this.then(function(r){return"object"==typeof r?1===e.length?r[e[0]]:e.reduce(function(t,e){return t[e]=r[e],t},{}):r}))},FP.prototype.set=function(e,r){return this.steps?this.addStep("set",Array.prototype.slice.call(arguments)):this.then(function(t){return"object"==typeof t&&(t[e]=r),t})},FP.prototype.catch=function(e){if(this.steps)return this.addStep("catch",Array.prototype.slice.call(arguments));if(2===arguments.length)return this.catchIf.apply(this,arguments);if(!isFunction(e))throw new errors_js.FunctionalError("Invalid fn argument for `.catch(fn)`. Must be a function. Currently: "+typeof e);return FP.resolve(this._FP.promise.catch(function(t){return e(t)}))},FP.prototype.catchIf=function(e,r){if(this.steps)return this.addStep("catchIf",Array.prototype.slice.call(arguments));if(!isFunction(r))throw new errors_js.FunctionalError("Invalid fn argument for `.catchIf(condition, fn)`. Must be a function. Currently: "+typeof r);return FP.resolve(this._FP.promise.catch(function(t){if(e&&t instanceof e)return r(t);throw t}))},FP.prototype.then=function(t){if(this.steps)return this.addStep("then",Array.prototype.slice.call(arguments));if(!isFunction(t))throw new errors_js.FunctionalError("Invalid fn argument for `.then(fn)`. Must be a function. Currently: "+typeof t);return FP.resolve(this._FP.promise.then(t))},FP.prototype.tap=function(e){if(this.steps)return this.addStep("tap",Array.prototype.slice.call(arguments));if(!isFunction(e))throw new errors_js.FunctionalError("Invalid fn argument for `.tap(fn)`. Must be a function. Currently: "+typeof e);return FP.resolve(this._FP.promise.then(function(t){return e(t),t}))},module.exports=FP;
