{"version":3,"file":"umd.min.js","sources":["../node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/construct.js","../node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","../src/modules/errors.js","../src/modules/utils.js","../src/arrays.js","../src/events.js","../src/conditional.js","../src/index.js","../src/promise.js","../src/monads.js"],"sourcesContent":["export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct\";\nexport default function _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","const { inherits } = require('util');\n\ninherits(FunctionalError, Error)\n\ninherits(FunctionalUserError, FunctionalError)\ninherits(FPCollectionError, FunctionalError)\ninherits(FPUnexpectedError, FunctionalError)\ninherits(FPInputError, FunctionalError)\ninherits(FPTimeout, FunctionalError)\n\nexport function FunctionalError(msg, options) {\n  if (!(this instanceof FunctionalError)) return new FunctionalError(...arguments)\n  if (typeof msg === 'object') {\n    options = msg\n    if ( options.message ) msg = options.message\n  }\n  Error.call(this, msg)\n  if (typeof msg === 'string') this.message = msg\n  if (typeof options === 'object') {\n    Object.getOwnPropertyNames(options)\n      .forEach(key => {\n        this[key] = options[key]\n      })\n  }\n  this.name = this.constructor.name\n  // Capturing stack trace, excluding constructor call from it.\n  Error.captureStackTrace(this)\n}\n\nexport function FunctionalUserError() {\n  if (!(this instanceof FunctionalUserError)) return new FunctionalUserError(...arguments)\n  FunctionalError.call(this, ...arguments)\n}\n\nexport function FPUnexpectedError() {\n  if (!(this instanceof FPUnexpectedError)) return new FPUnexpectedError(...arguments)\n  FunctionalError.call(this, ...arguments)\n}\n\nexport function FPInputError() {\n  if (!(this instanceof FPInputError)) return new FPInputError(...arguments)\n  FunctionalError.call(this, ...arguments)\n}\n\nexport function FPCollectionError() {\n  if (!(this instanceof FPCollectionError)) return new FPCollectionError(...arguments)\n  FunctionalError.call(this, ...arguments)\n}\n\nexport function FPTimeout() {\n  if (!(this instanceof FPTimeout)) return new FPTimeout(...arguments)\n  FunctionalError.call(this, ...arguments)\n}\n\n\n","const utils = {\n  isPromiseLike(p) { return !!(p && typeof p.then === 'function') },\n  isFunction(fn) { return typeof fn === 'function' },\n  isEnumerable(list) { return list && Array.isArray(list) || list && typeof list[Symbol.iterator] === 'function' },\n  isObject(o) { return !!Object.prototype.toString.call(o) === '[object Object]' },\n\n  flatten(arr) {\n    if (!Array.isArray(arr)) throw new Error('Method `flatten` requires valid array parameter')\n    return arr.reduce((results, item) => results.concat(Array.isArray(item) ? utils.flatten(item) : [item]), [])\n  },\n}\nexport default utils","import utils from './modules/utils'\nimport { FPInputError, FPCollectionError, FunctionalError } from './modules/errors'\nconst { isEnumerable } = utils\n\nexport default function(FP) {\n\n  return { map, find, findIndex, filter, flatMap, reduce }\n\n  function find(callback) { return _find.call(this, callback).then(({ item }) => item) }\n  function findIndex(callback) { return _find.call(this, callback).then(({ index }) => index) }\n\n  function _find(iterable, callback) {\n    if (this.steps) return this.addStep('_find', [...arguments])\n    if (typeof iterable === 'function') {\n      callback = iterable\n      iterable = this._FP.promise\n    }\n\n    return FP.resolve(iterable)\n      .filter(callback)\n      .then((results) => results[0] != undefined ? { item: results[0], index: results.indexOf(results[0]) } : { item: undefined, index: -1 })\n  }\n  \n  function flatMap(iterable, callback) {\n    if (this.steps) return this.addStep('flatMap', [...arguments])\n    if (typeof iterable === 'function') {\n      callback = iterable\n      iterable = this._FP.promise\n    }\n    \n    return FP.resolve(iterable)\n      .map(callback)\n      .reduce((acc, arr) => acc.concat(...arr), [])\n  }\n\n\n  function filter(iterable, callback) {\n    if (this.steps) return this.addStep('filter', [...arguments])\n    if (typeof iterable === 'function') {\n      callback = iterable\n      iterable = this._FP.promise\n    }\n\n    return reduce.call(this, iterable, (acc, item) => Promise.resolve(callback(item)).then(x => (x ? acc.concat([item]) : acc)), [])\n  }\n\n  function reduce(iterable, reducer, initVal) {\n    if (this.steps) return this.addStep('reduce', [...arguments])\n    if (typeof iterable === 'function') {\n      initVal = reducer\n      reducer = iterable\n      iterable = this._FP ? this._FP.promise : this\n    } else iterable = FP.resolve(iterable, this)\n\n    return new FP((resolve, reject) => {\n      return iterable.then(iterable => {\n        const iterator = iterable[Symbol.iterator]()\n        let i = 0\n\n        const next = total => {\n          const current = iterator.next()\n          if (current.done) return resolve(total)\n\n          Promise.all([total, current.value])\n            .then(([total, item]) => next(reducer(total, item, i++))).catch(reject)\n        }\n\n        next(initVal)\n      })\n    })\n  }\n  \n  /*eslint max-statements: [\"error\", 60]*/\n  function map(args, fn, options) {\n    if (this.steps) return this.addStep('map', [...arguments])\n    if (arguments.length === 1 && this && this._FP) {\n      fn = args\n      args = this && this._FP && this._FP.promise\n    }\n    let resolvedOrRejected = false\n    const threadLimit = Math.max(1, (this && this._FP && this._FP.concurrencyLimit || 1))\n    const innerValues = this && this._FP && this._FP.promise ? this._FP.promise : Promise.resolve(args)\n    let initialThread = 0\n    let errors = []\n    let count = 0\n    const results = []\n    const threadPool = new Set()\n    const threadPoolFull = () => threadPool.size >= threadLimit\n    const isDone = () => errors.length > this._FP.errors.limit || count >= args.length || resolvedOrRejected\n    const setResult = index => value => {\n      threadPool.delete(index)\n      results[index] = value\n      return value\n    }\n    return FP.resolve(new Promise((resolve, reject) => {\n      const resolveIt = x => {\n        // console.log('Action.resolve:', resolvedOrRejected, x)\n        if (resolvedOrRejected) { return null } else { resolvedOrRejected = true }\n        resolve(x)\n      }\n      const rejectIt = x => {\n        if (resolvedOrRejected) { return null } else { resolvedOrRejected = true }\n        // console.log('Action.reject:', resolvedOrRejected, x)\n        reject(x)\n      }\n      innerValues.then(items => {\n        if (!isEnumerable(items)) return reject(new FPCollectionError(`Value must be iterable! A '${typeof items}' was passed into FP.map()`))\n        args = [...items]\n        const complete = () => {\n          let action = null\n          if (errors.length > this._FP.errors.limit) action = rejectIt\n          if (isDone()) action = resolveIt\n          if (action) return Promise.all(results).then(data => action(results)) ? true : true\n          return false\n        }\n        const checkAndRun = val => {\n          // console.log('checkAndRun', count, resolvedOrRejected, val)\n          if (resolvedOrRejected) return\n          if (!complete() && !results[count]) runItem(count)\n          return val\n        }\n\n        const runItem = c => {\n          if (resolvedOrRejected) {return null} else {count++}\n          if (threadPoolFull()) return setTimeout(() => runItem(c), 0)\n          if (results[c]) return results[c]\n          threadPool.add(c)\n          // either get value with `fn(item)` or `item.then(fn)`\n          results[c] = Promise.resolve(args[c])\n            .then(val => fn(val, c, args))\n            .then(val => setResult(c)(val))\n            .then(checkAndRun)\n            .catch(err => {\n              this._FP.errors.count++\n              err._index = c\n              errors.push(err)\n              if (this._FP.errors.limit <= 0) {\n                rejectIt(err)\n                return err\n              }\n              if (errors.length > this._FP.errors.limit) {\n                let fpErr = new FPCollectionError(`Error limit ${this._FP.errors.limit} met/exceeded with ${this._FP.errors.count} errors.`, { errors, results, ctx: this })\n                Promise.resolve(setResult(c)(err)).then(() => rejectIt(fpErr))\n              } else { // console.warn('Error OK:', JSON.stringify(this._FP.errors))\n                return Promise.resolve().then(() => setResult(c)(err)).then(checkAndRun)\n              }\n            })\n\n          return results[c]\n        }\n\n        // Kick off x number of initial threads\n        while (initialThread < threadLimit && initialThread < args.length) runItem(initialThread++)\n      })\n    }))\n  }\n}\n","import { FPInputError } from './modules/errors'\n\nexport const listen = function listen(obj, ...eventNames) {\n  if (typeof eventNames === 'string') eventNames = [eventNames]\n  if (!obj[obj.addEventListener ? 'addEventListener' : 'on']) throw new FPInputError('Valid EventEmitter required.')\n  // Gets callback to attach to the event handlers\n  const handler = this.chainEnd()\n  this._FP.destroy = () => this._FP.destroyHandles.map(fn => fn() || true).filter(v => v).length\n  this._FP.destroyHandles = eventNames.map(eventName => {\n    obj[obj.addEventListener ? 'addEventListener' : 'on'](eventName, handler)\n    return () => obj[obj.removeEventListener ? 'removeEventListener' : 'off'](eventName, handler)\n  })\n  return this\n}","import utils from './modules/utils'\n\nconst { isPromiseLike } = utils\n\nexport default function conditional(FP) {\n  return { tapIf, thenIf, _thenIf }\n\n  function thenIf(cond, ifTrue, ifFalse) {\n    if (this.steps) return this.addStep('thenIf', [...arguments])\n    if (arguments.length === 1) {\n      ifTrue = cond\n      cond = x => x\n    }\n    if (isPromiseLike(this)) {\n      return this.then(value => _thenIf(cond, ifTrue, ifFalse)(value))\n    }\n    return _thenIf(cond, ifTrue, ifFalse)\n  }\n\n  function tapIf(cond, ifTrue, ifFalse) {\n    if (this.steps) return this.addStep('tapIf', [...arguments])\n    if (arguments.length === 1) {\n      ifTrue = cond\n      cond = x => x\n    }\n    if (isPromiseLike(this)) {\n      return this.then(value => _thenIf(cond, ifTrue, ifFalse, true)(value))\n    }\n    return _thenIf(cond, ifTrue, ifFalse, true)\n  }\n\n  function _thenIf(cond = x => x, ifTrue = x => x, ifFalse = () => null, returnValue = false) {\n    return value =>\n      FP.resolve(cond(value))\n        .then(ans => (ans ? ifTrue(value) : ifFalse(value)))\n        .then(v => (returnValue ? value : v))\n  }\n}\n","import { FunctionalError } from './modules/errors'\nimport utils from './modules/utils'\nimport monads from './monads'\nimport arrays from './arrays'\nimport { listen } from './events'\nimport conditional from './conditional'\nimport promise from './promise'\n\n\nconst { isFunction, flatten } = utils\nconst { map, find, findIndex, filter, flatMap, reduce } = arrays(FP)\nconst { all, reject, delay, _delay } = promise(FP)\nconst { tapIf, thenIf, _thenIf } = conditional(FP)\nconst { chain, chainEnd } = monads(FP)\n\nFP.prototype.all = all\nFP.prototype.map = map\nFP.prototype.find = find\nFP.prototype.findIndex = findIndex\nFP.prototype.filter = filter\nFP.prototype.flatMap = flatMap\nFP.prototype.reduce = reduce\nFP.prototype.listen = listen\nFP.prototype.tapIf = tapIf\nFP.prototype.thenIf = thenIf\nFP.prototype._thenIf = _thenIf\nFP.prototype.delay = delay\nFP.prototype._delay = _delay\nFP.prototype.reject = reject\n\n// FP.default = FP\n// export const all = allPromises\n\nFP.all = FP.prototype.all\nFP.thenIf = FP.prototype._thenIf\nFP.delay = msec => FP.resolve().delay(msec)\nFP.silent = limit => FP.resolve().silent(limit)\n\n// Monadic Methods\nFP.chain = chain\nFP.prototype.chainEnd = chainEnd\nFP.reject = FP.prototype.reject\nFP.resolve = resolve\n\nFP.promisify = promisify\nFP.promisifyAll = promisifyAll\nFP.unpack = unpack\n\nFP.prototype.addStep = function addStep(name, args) {\n  if (this.steps) this.steps.push([name, this, args])\n  return this\n}\n\nFP.prototype.concurrency = function concurrency(limit = Infinity) {\n  if (this.steps) return this.addStep('concurrency', [...arguments])\n  this._FP.concurrencyLimit = limit\n  return this\n}\n\nFP.prototype.quiet = function quiet(errorLimit = Infinity) {\n  if (this.steps) return this.addStep('quiet', [...arguments])\n  this._FP.errors = { count: 0, limit: errorLimit }\n  return this\n}\nFP.prototype.silent = FP.prototype.quiet\n\n/**\n * Helper to accumulate string keys *until an object is provided*. \n * Returns a partial function to accept more keys until partial \n */\nFP.get = function getter(...getArgs) {\n  getArgs = flatten(getArgs)\n  const keyNames = getArgs.filter(s => typeof s === 'string')\n  const objectFound = getArgs.find(s => typeof s !== 'string')\n  // Return partial app / auto-curry deal here\n  if (!objectFound) { // return function to keep going\n    return (...extraArgs) => FP.get(...extraArgs, ...getArgs)\n  }\n\n  if (keyNames.length === 1) return objectFound[keyNames[0]]\n  return keyNames.reduce((extracted, key) => {\n    extracted[key] = objectFound[key]\n    return extracted\n  }, {})\n\n}\n\nFP.prototype.get = function get(...keyNames) {\n  if (this.steps) return this.addStep('get', [...arguments])\n  return this.then\n     ? this.then(FP.get(keyNames))\n     : FP.get(...keyNames)\n}\n\nFP.prototype.set = function set(keyName, value) {\n  if (this.steps) return this.addStep('set', [...arguments])\n  return this.then(obj => {\n    if (typeof obj === 'object') obj[keyName] = value\n    return obj\n  })\n}\n\nFP.prototype.catch = function (fn) {\n  if (this.steps) return this.addStep('catch', [...arguments])\n  if (arguments.length === 2) return this.catchIf(...arguments)\n  if (!isFunction(fn)) throw new FunctionalError('Invalid fn argument for `.catch(fn)`. Must be a function. Currently: ' + typeof fn)\n  return FP.resolve(this._FP.promise.catch(err => fn(err)))\n}\n\nFP.prototype.catchIf = function catchIf(condition, fn) {\n  if (this.steps) return this.addStep('catchIf', [...arguments])\n  if (!isFunction(fn)) throw new FunctionalError('Invalid fn argument for `.catchIf(condition, fn)`. Must be a function. Currently: ' + typeof fn)\n\n  return FP.resolve(this._FP.promise.catch(err => {\n    if (condition && err instanceof condition) return fn(err) // try re-throw, might be really slow...\n    throw err\n  }))\n}\n\nFP.prototype.then = function then(fn) {\n  if (this.steps) return this.addStep('then', [...arguments])\n  if (!isFunction(fn)) throw new FunctionalError('Invalid fn argument for `.then(fn)`. Must be a function. Currently: ' + typeof fn)\n  return FP.resolve(this._FP.promise.then(fn))\n}\n\nFP.prototype.tap = function tap(fn) {\n  if (this.steps) return this.addStep('tap', [...arguments])\n  if (!isFunction(fn)) throw new FunctionalError('Invalid fn argument for `.tap(fn)`. Must be a function. Currently: ' + typeof fn)\n  return FP.resolve(this._FP.promise.then(value => fn(value) ? value : value))\n}\n\nfunction resolve(value) {\n  return new FP((resolve, reject) => {\n    if (value && isFunction(value.then)) return value.then(resolve).catch(reject)\n    resolve(value)\n  })\n}\n\nfunction promisify(cb) {\n  return (...args) => new FP((yah, nah) =>\n    cb.call(this, ...args, (err, res) => err ? nah(err) : yah(res)))\n}\n\nfunction promisifyAll(obj) {\n  if (!obj || !Object.getPrototypeOf(obj)) { throw new Error('Invalid Argument obj in promisifyAll(obj)') }\n  return Object.getOwnPropertyNames(obj)\n    .filter(key => typeof obj[key] === 'function')\n    .reduce((obj, fnName) => {\n      if (!/Sync/.test(fnName) && !obj[`${fnName}Async`]) obj[`${fnName}Async`] = FP.promisify(obj[`${fnName}`])\n      return obj\n    }, obj)\n}\n\nfunction unpack() {\n  let resolve, reject, promise = new FP((yah, nah) => { resolve = yah; reject = nah })\n  return { promise, resolve, reject }\n}\n\n\nexport default function FP(resolveRejectCB) {\n  if (!(this instanceof FP)) { return new FP(resolveRejectCB) }\n  if (arguments.length !== 1) throw new Error('FunctionalPromises constructor only accepts 1 callback argument')\n  this._FP = {\n    errors:           { limit: 0, count: 0 },\n    promise:          new Promise(resolveRejectCB),\n    concurrencyLimit: 4,\n  }\n}\n// if (process && process.on) {\n//   // process.on('uncaughtException', e => console.error('FPromises: FATAL EXCEPTION: uncaughtException', e))\n//   process.on('unhandledRejection', e => console.error('FPromises: FATAL ERROR: unhandledRejection', e))\n// }\n","import { FPInputError } from './modules/errors'\n\nexport default function(FP) {\n\n  return { all, reject, delay, _delay }\n\n  function all(promises) {\n    return FP.resolve(Array.isArray(promises) ? Promise.all(promises) : promiseAllObject(promises))\n  }\n\n  function promiseAllObject(obj) {\n    const keys = Object.getOwnPropertyNames(obj)\n    const values = keys.map(key => obj[key])\n    return Promise.all(values).then(results => results.reduce((obj, val, index) => {\n      const key = keys[index]\n      return Object.assign({ [key]: val }, obj)\n    }, {}))\n  }\n\n  function reject(err) {\n    if (err instanceof Error) {\n      if (this) this._error = err\n      return Promise.reject(err)\n    }\n    throw new Error(`Reject only accepts a new instance of Error!`)\n  }\n\n  function _delay(msec) {\n    if (!Number.isInteger(msec)) throw new FPInputError('FP.delay(millisec) requires a numeric arg.')\n    return value => new FP(resolve => { setTimeout(() => resolve(value), msec) })\n  }\n\n  function delay(msec) {\n    if (this.steps) return this.addStep('delay', [...arguments])\n    return this && this._FP ? FP.resolve(this.then(_delay(msec))) : _delay(msec)()\n  }\n}\n","import { FPInputError } from './modules/errors'\n\nexport default function monads(FP) {\n\n  return {chain, chainEnd}\n\n  /**\n   * Start 'recording' a chain of commands, after steps defined call `.chainEnd()`\n   * @returns FunctionalPromise\n   */\n  function chain() {\n    // create a placeholder/initial promise to hold the steps/chain data\n    const promise = FP.resolve()\n    promise.steps = []\n    return promise\n  }\n\n  /**\n   * Call after starting a `.chain()`.\n   *\n   * One of the few non-chainable methods in the API.\n   * @returns a Function. It runs your functional chain!\n   */\n  function chainEnd() {\n    return input => {\n      if (!this.steps || this.steps.length <= 0) throw new FPInputError('No steps defined between .chain() & .chainEnd()')\n      let stepCount = 0\n      let {promise, resolve, reject} = FP.unpack()\n      while (stepCount < this.steps.length) {\n        const [fnName, , args] = this.steps[stepCount]\n        promise = promise[fnName](...args)\n        stepCount++\n      }\n      resolve(input)\n      return promise\n    }\n  }\n}\n"],"names":["_setPrototypeOf","o","p","Object","setPrototypeOf","__proto__","_construct","Parent","args","Class","Reflect","construct","sham","Proxy","Date","prototype","toString","call","e","isNativeReflectConstruct","a","push","apply","instance","Function","bind","arguments","inherits","require","FunctionalError","msg","options","this","message","Error","getOwnPropertyNames","forEach","key","_this","name","constructor","captureStackTrace","FPInputError","FPCollectionError","FunctionalUserError","FPUnexpectedError","FPTimeout","utils","isPromiseLike","then","isFunction","fn","isEnumerable","list","Array","isArray","Symbol","iterator","isObject","flatten","arr","reduce","results","item","concat","FP","map","steps","addStep","setResult","index","value","threadPool","length","_FP","promise","resolvedOrRejected","threadLimit","Math","max","concurrencyLimit","innerValues","Promise","resolve","initialThread","errors","count","Set","reject","resolveIt","x","rejectIt","items","complete","action","limit","all","data","checkAndRun","val","runItem","c","size","setTimeout","add","err","_index","fpErr","ctx","find","callback","_find","findIndex","filter","iterable","acc","flatMap","undefined","indexOf","reducer","initVal","i","next","total","current","done","promises","obj","keys","values","assign","promiseAllObject","_error","delay","msec","_delay","Number","isInteger","tapIf","cond","ifTrue","ifFalse","_thenIf","thenIf","returnValue","ans","v","chain","chainEnd","input","stepCount","unpack","fnName","resolveRejectCB","listen","eventNames","addEventListener","handler","destroy","destroyHandles","eventName","removeEventListener","silent","promisify","cb","yah","nah","res","promisifyAll","getPrototypeOf","test","concurrency","Infinity","quiet","errorLimit","get","getArgs","keyNames","s","objectFound","extracted","extraArgs","set","keyName","catchIf","condition","tap"],"mappings":"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"}