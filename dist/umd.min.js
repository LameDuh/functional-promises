!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).FP=e()}(this,function(){"use strict";function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function n(t,e,r){return(n=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&i(o,r.prototype),o}).apply(null,arguments)}var t=require("util").inherits;function o(t,e){var r=this;if(!(this instanceof o))return n(o,Array.prototype.slice.call(arguments));"object"==typeof t&&(e=t).message&&(t=e.message),Error.call(this,t),"string"==typeof t&&(this.message=t),"object"==typeof e&&Object.getOwnPropertyNames(e).forEach(function(t){r[t]=e[t]}),this.name=this.constructor.name,Error.captureStackTrace(this)}function g(){if(!(this instanceof g))return n(g,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))}function w(){if(!(this instanceof w))return n(w,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))}t(o,Error),t(function t(){if(!(this instanceof t))return n(t,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))},o),t(w,o),t(function t(){if(!(this instanceof t))return n(t,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))},o),t(g,o),t(function t(){if(!(this instanceof t))return n(t,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))},o);var r={isPromiseLike:function(t){return!(!t||"function"!=typeof t.then)},isFunction:function(t){return"function"==typeof t},isEnumerable:function(t){return t&&Array.isArray(t)||t&&"function"==typeof t[Symbol.iterator]},isObject:function(t){return"[object Object]"===!!Object.prototype.toString.call(t)},flatten:function(t){if(!Array.isArray(t))throw new Error("Method `flatten` requires valid array parameter");return t.reduce(function(t,e){return t.concat(Array.isArray(e)?r.flatten(e):[e])},[])}};var e,c=(function(t){var e=function(c){var l,t=Object.prototype,f=t.hasOwnProperty,e="function"==typeof Symbol?Symbol:{},o=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",n=e.toStringTag||"@@toStringTag";function i(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{i({},"")}catch(t){i=function(t,e,r){return t[e]=r}}function a(t,e,r,n){var i,c,a,u,o=e&&e.prototype instanceof g?e:g,s=Object.create(o.prototype),f=new L(n||[]);return s._invoke=(i=t,c=r,a=f,u=h,function(t,e){if(u===d)throw new Error("Generator is already running");if(u===v){if("throw"===t)throw e;return S()}for(a.method=t,a.arg=e;;){var r=a.delegate;if(r){var n=function t(e,r){var n=e.iterator[r.method];if(n===l){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=l,t(e,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=p(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,m;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=l),r.delegate=null,m):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}(r,a);if(n){if(n===m)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(u===h)throw u=v,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);u=d;var o=p(i,c,a);if("normal"===o.type){if(u=a.done?v:y,o.arg===m)continue;return{value:o.arg,done:a.done}}"throw"===o.type&&(u=v,a.method="throw",a.arg=o.arg)}}),s}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}c.wrap=a;var h="suspendedStart",y="suspendedYield",d="executing",v="completed",m={};function g(){}function u(){}function s(){}var w={};w[o]=function(){return this};var P=Object.getPrototypeOf,_=P&&P(P(j([])));_&&_!==t&&f.call(_,o)&&(w=_);var b=s.prototype=g.prototype=Object.create(w);function A(t){["next","throw","return"].forEach(function(e){i(t,e,function(t){return this._invoke(e,t)})})}function E(u,s){var e;this._invoke=function(r,n){function t(){return new s(function(t,e){!function e(t,r,n,o){var i=p(u[t],u,r);if("throw"!==i.type){var c=i.arg,a=c.value;return a&&"object"==typeof a&&f.call(a,"__await")?s.resolve(a.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):s.resolve(a).then(function(t){c.value=t,n(c)},function(t){return e("throw",t,n,o)})}o(i.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function F(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function j(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(f.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=l,t.done=!0,t};return n.next=n}}return{next:S}}function S(){return{value:l,done:!0}}return((u.prototype=b.constructor=s).constructor=u).displayName=i(s,n,"GeneratorFunction"),c.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===u||"GeneratorFunction"===(e.displayName||e.name))},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,i(t,n,"GeneratorFunction")),t.prototype=Object.create(b),t},c.awrap=function(t){return{__await:t}},A(E.prototype),E.prototype[r]=function(){return this},c.AsyncIterator=E,c.async=function(t,e,r,n,o){void 0===o&&(o=Promise);var i=new E(a(t,e,r,n),o);return c.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},A(b),i(b,n,"Generator"),b[o]=function(){return this},b.toString=function(){return"[object Generator]"},c.keys=function(r){var n=[];for(var t in r)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},c.values=j,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(F),!t)for(var e in this)"t"===e.charAt(0)&&f.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return i.type="throw",i.arg=r,n.next=t,e&&(n.method="next",n.arg=l),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var c=f.call(o,"catchLoc"),a=f.call(o,"finallyLoc");if(c&&a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&f.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),F(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n,o=r.completion;return"throw"===o.type&&(n=o.arg,F(r)),n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=l),m}},c}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}(e={exports:{}}),e.exports);function u(t,e,r,n,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,o)}var P=r.isEnumerable;var a=r.isPromiseLike;var _,s=r.isFunction,f=r.flatten,l={map:function(a,u,t){var s=this;if(this.steps)return this.addStep("map",Array.prototype.slice.call(arguments));function f(e){return function(t){return m.delete(e),v[e]=t}}1===arguments.length&&this&&this._FP&&(u=a,a=this&&this._FP&&this._FP.promise);var l=!1,p=Math.max(1,this&&this._FP&&this._FP.concurrencyLimit||1),r=this&&this._FP&&this._FP.promise?this._FP.promise:Promise.resolve(a),h=0,y=[],d=0,v=[],m=new Set;return _.resolve(new Promise(function(e,o){function i(t){if(l)return null;l=!0,e(t)}function c(t){if(l)return null;l=!0,o(t)}r.then(function(t){if(!P(t))return o(new g("Value must be iterable! A '"+typeof t+"' was passed into FP.map()",{input:t}));a=[].concat(t);for(var e=function(){var e=null;return y.length>s._FP.errors.limit&&(e=c),(y.length>s._FP.errors.limit||d>=a.length||l)&&(e=i),!!e&&(Promise.all(v).then(function(t){return e(v)}),!0)},n=function(t){if(!l)return e()||v[d]||r(d),t},r=function t(r){return l?null:(d++,m.size>=p?setTimeout(function(){return t(r)},0):(v[r]||(m.add(r),v[r]=Promise.resolve(a[r]).then(function(t){return u(t,r,a)}).then(function(t){return f(r)(t)}).then(n).catch(function(t){if(s._FP.errors.count++,t._index=r,y.push(t),s._FP.errors.limit<=0)return c(t),t;if(!(y.length>s._FP.errors.limit))return Promise.resolve().then(function(){return f(r)(t)}).then(n);var e=new w("Error limit "+s._FP.errors.limit+" met/exceeded with "+s._FP.errors.count+" errors.",{errors:y,results:v,ctx:s});Promise.resolve(f(r)(t)).then(function(){return c(e)})})),v[r]))};h<p&&h<a.length;)r(h++)})}))},find:function(t){return b.call(this,t).then(function(t){return t.item})},findIndex:function(t){return b.call(this,t).then(function(t){return t.index})},filter:function(t,n){return this.steps?this.addStep("filter",Array.prototype.slice.call(arguments)):("function"==typeof t&&(n=t,t=this._FP.promise),A.call(this,t,function(e,r){return Promise.resolve(n(r)).then(function(t){return t?e.concat([r]):e})},[]))},flatMap:function(t,e){return this.steps?this.addStep("flatMap",Array.prototype.slice.call(arguments)):("function"==typeof t&&(e=t,t=this._FP.promise),_.resolve(t).map(e).reduce(function(t,e){return t.concat.apply(t,e)},[]))},reduce:A},p=l.map,h=l.find,y=l.findIndex,d=l.filter,v=l.flatMap,m=l.reduce;function b(t,o){return this.steps?this.addStep("_find",Array.prototype.slice.call(arguments)):("function"==typeof t&&(o=t,t=this._FP.promise),_.resolve(t).reduce(function(){var a,n=(a=c.mark(function t(e,r,n){return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.item){t.next=6;break}return t.next=3,o(r);case 3:if(!t.sent){t.next=6;break}e.item=r,e.index=n;case 6:return t.abrupt("return",e);case 7:case"end":return t.stop()}},t)}),function(){var t=this,c=arguments;return new Promise(function(e,r){var n=a.apply(t,c);function o(t){u(n,e,r,o,i,"next",t)}function i(t){u(n,e,r,o,i,"throw",t)}o(void 0)})});return function(t,e,r){return n.apply(this,arguments)}}(),{item:void 0,index:-1}))}function A(t,a,e){return this.steps?this.addStep("reduce",Array.prototype.slice.call(arguments)):(t="function"==typeof t?(e=a,a=t,this._FP?this._FP.promise:this):_.resolve(t,this),new _(function(i,c){return t.then(function(t){var r=t[Symbol.iterator](),o=0;!function n(t){var e=r.next();if(e.done)return i(t);Promise.all([t,e.value]).then(function(t){var e=t[0],r=t[1];return n(a(e,r,o++))}).catch(c)}(e)})}))}var E,x={all:function(t){return E.resolve(Array.isArray(t)?Promise.all(t):function(e){var i=Object.getOwnPropertyNames(e),t=i.map(function(t){return e[t]});return Promise.all(t).then(function(t){return t.reduce(function(t,e,r){var n,o=i[r];return Object.assign(((n={})[o]=e,n),t)},{})})}(t))},delay:function(t){return this.steps?this.addStep("delay",Array.prototype.slice.call(arguments)):this&&this._FP?E.resolve(this.then(S(t))):S(t)()},_delay:S},F=x.all,L=x.delay,j=x._delay;function S(r){if(!Number.isInteger(r))throw new g("FP.delay(millisec) requires a numeric arg.");return function(e){return new E(function(t){setTimeout(function(){return t(e)},r)})}}var I,O={tapIf:function(e,r,n){return this.steps?this.addStep("tapIf",Array.prototype.slice.call(arguments)):(1===arguments.length&&(r=e,e=function(t){return t}),a(this)?this.then(function(t){return T(e,r,n,!0)(t)}):T(e,r,n,!0))},thenIf:function(e,r,n){return this.steps?this.addStep("thenIf",Array.prototype.slice.call(arguments)):(1===arguments.length&&(r=e,e=function(t){return t}),a(this)?this.then(function(t){return T(e,r,n)(t)}):T(e,r,n))},_thenIf:T},k=O.tapIf,N=O.thenIf,M=O._thenIf;function T(t,r,n,o){return void 0===t&&(t=function(t){return t}),void 0===r&&(r=function(t){return t}),void 0===n&&(n=function(){return null}),void 0===o&&(o=!1),function(e){return I.resolve(t(e)).then(function(t){return(t?r:n)(e)}).then(function(t){return o?e:t})}}var R,G={chain:function(){var t=R.resolve();return t.steps=[],t},chainEnd:function(){var u=this;return function(t){if(!u.steps||u.steps.length<=0)throw new g("No steps defined between .chain() & .chainEnd()");var e=0,r=R.unpack(),n=r.promise,o=r.resolve;for(r.reject;e<u.steps.length;){var i=u.steps[e],c=i[0],a=i[2],n=n[c].apply(n,a);e++}return o(t),n}}},q=G.chain,C=G.chainEnd;function D(t){if(!(this instanceof D))return new D(t);if(1!==arguments.length)throw new Error("FunctionalPromises constructor only accepts 1 callback argument");this._FP={errors:{limit:0,count:0},promise:new Promise(t),concurrencyLimit:4}}return(R=I=E=_=D).prototype.all=F,D.prototype.map=p,D.prototype.find=h,D.prototype.findIndex=y,D.prototype.filter=d,D.prototype.flatMap=v,D.prototype.reduce=m,D.prototype.listen=function(e){for(var t=this,r=arguments.length,n=new Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];if("string"==typeof n&&(n=[n]),!e[e.addEventListener?"addEventListener":"on"])throw new g("Valid EventEmitter required.");var i=this.chainEnd();return this._FP.destroy=function(){return t._FP.destroyHandles.map(function(t){return t()||!0}).filter(function(t){return t}).length},this._FP.destroyHandles=n.map(function(t){return e[e.addEventListener?"addEventListener":"on"](t,i),function(){return e[e.removeEventListener?"removeEventListener":"off"](t,i)}}),this},D.prototype.tapIf=k,D.prototype.thenIf=N,D.prototype._thenIf=M,D.prototype.delay=L,D.prototype._delay=j,D.prototype.reject=function(t){if(t instanceof Error)return this&&(this._error=t),Promise.reject(t);throw new Error("Reject only accepts a new instance of Error!")},D.all=D.prototype.all,D.thenIf=D.prototype._thenIf,D.delay=function(t){return D.resolve().delay(t)},D.silent=function(t){return D.resolve().silent(t)},D.chain=q,D.prototype.chainEnd=C,D.reject=D.prototype.reject,D.resolve=function(r){return new D(function(t,e){if(r&&s(r.then))return r.then(t).catch(e);t(r)})},D.promisify=function(o){var i=this;return function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new D(function(r,n){return o.call.apply(o,[i].concat(e,[function(t,e){return t?n(t):r(e)}]))})}},D.promisifyAll=function(e){if(e&&Object.getPrototypeOf(e))return Object.getOwnPropertyNames(e).filter(function(t){return"function"==typeof e[t]}).reduce(function(t,e){return/Sync/.test(e)||t[e+"Async"]||(t[e+"Async"]=D.promisify(t[""+e])),t},e);throw new Error("Invalid Argument obj in promisifyAll(obj)")},D.unpack=function(){var r,n;return{promise:new D(function(t,e){r=t,n=e}),resolve:r,reject:n}},D.prototype.addStep=function(t,e){return this.steps&&this.steps.push([t,this,e]),this},D.prototype.concurrency=function(t){return void 0===t&&(t=1/0),this.steps?this.addStep("concurrency",Array.prototype.slice.call(arguments)):(this._FP.concurrencyLimit=t,this)},D.prototype.silent=D.prototype.quiet=function(t){return void 0===t&&(t=1/0),this.steps?this.addStep("quiet",Array.prototype.slice.call(arguments)):(this._FP.errors={count:0,limit:t},this)},D.get=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=(n=f(n)).filter(function(t){return"string"==typeof t}),o=n.find(function(t){return"string"!=typeof t});return o?1===r.length?o[r[0]]:r.reduce(function(t,e){return t[e]=o[e],t},{}):function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return D.get.apply(D,e.concat(n))}},D.prototype.get=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.steps?this.addStep("get",Array.prototype.slice.call(arguments)):this.then?this.then(D.get(e)):D.get.apply(D,e)},D.prototype.set=function(e,r){return this.steps?this.addStep("set",Array.prototype.slice.call(arguments)):this.then(function(t){return"object"==typeof t&&(t[e]=r),t})},D.prototype.catch=function(e){if(this.steps)return this.addStep("catch",Array.prototype.slice.call(arguments));if(2===arguments.length)return this.catchIf.apply(this,arguments);if(!s(e))throw new o("Invalid fn argument for `.catch(fn)`. Must be a function. Currently: "+typeof e);return D.resolve(this._FP.promise.catch(function(t){return e(t)}))},D.prototype.catchIf=function(e,r){if(this.steps)return this.addStep("catchIf",Array.prototype.slice.call(arguments));if(!s(r))throw new o("Invalid fn argument for `.catchIf(condition, fn)`. Must be a function. Currently: "+typeof r);return D.resolve(this._FP.promise.catch(function(t){if(e&&t instanceof e)return r(t);throw t}))},D.prototype.then=function(t,e){if(this.steps)return this.addStep("then",Array.prototype.slice.call(arguments));if(!s(t))throw new o("Invalid fn argument for `.then(fn)`. Must be a function. Currently: "+typeof onResolved);return D.resolve(this._FP.promise.then(t,e))},D.prototype.tap=function(e){if(this.steps)return this.addStep("tap",Array.prototype.slice.call(arguments));if(!s(e))throw new o("Invalid fn argument for `.tap(fn)`. Must be a function. Currently: "+typeof e);return D.resolve(this._FP.promise.then(function(t){return e(t),t}))},D});
//# sourceMappingURL=umd.min.js.map
