!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).FP=e()}(this,function(){"use strict";function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function n(t,e,r){return(n=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);n=new(Function.bind.apply(t,n));return r&&i(n,r.prototype),n}).apply(null,arguments)}var t=require("util").inherits;function o(t,e){var r=this;if(!(this instanceof o))return n(o,Array.prototype.slice.call(arguments));"object"==typeof t&&(e=t).message&&(t=e.message),Error.call(this,t),"string"==typeof t&&(this.message=t),"object"==typeof e&&Object.getOwnPropertyNames(e).forEach(function(t){r[t]=e[t]}),this.name=this.constructor.name,Error.captureStackTrace(this)}function P(){if(!(this instanceof P))return n(P,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))}function g(){if(!(this instanceof g))return n(g,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))}t(o,Error),t(function t(){if(!(this instanceof t))return n(t,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))},o),t(g,o),t(function t(){if(!(this instanceof t))return n(t,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))},o),t(P,o),t(function t(){if(!(this instanceof t))return n(t,Array.prototype.slice.call(arguments));o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))},o);var r={isPromiseLike:function(t){return!(!t||"function"!=typeof t.then)},isFunction:function(t){return"function"==typeof t},isEnumerable:function(t){return t&&Array.isArray(t)||t&&"function"==typeof t[Symbol.iterator]},isObject:function(t){return"[object Object]"===!!Object.prototype.toString.call(t)},flatten:function(t){if(!Array.isArray(t))throw new Error("Method `flatten` requires valid array parameter");return t.reduce(function(t,e){return t.concat(Array.isArray(e)?r.flatten(e):[e])},[])}};var w=r.isEnumerable;var c=r.isPromiseLike;var A,s=r.isFunction,u=r.flatten,e={map:function(s,u,t){var a=this;if(this.steps)return this.addStep("map",Array.prototype.slice.call(arguments));1===arguments.length&&this&&this._FP&&(u=s,s=this&&this._FP&&this._FP.promise);function f(e){return function(t){return v.delete(e),m[e]=t}}var l=!1,p=Math.max(1,this&&this._FP&&this._FP.concurrencyLimit||1),r=this&&this._FP&&this._FP.promise?this._FP.promise:Promise.resolve(s),h=0,y=[],d=0,m=[],v=new Set;return A.resolve(new Promise(function(e,i){function o(t){if(l)return null;l=!0,e(t)}function c(t){if(l)return null;l=!0,i(t)}r.then(function(t){if(!w(t))return i(new P("Value must be iterable! A '"+typeof t+"' was passed into FP.map()",{input:t}));s=[].concat(t);for(var e=function(){var e=null;return y.length>a._FP.errors.limit&&(e=c),(y.length>a._FP.errors.limit||d>=s.length||l)&&(e=o),!!e&&(Promise.all(m).then(function(t){return e(m)}),!0)},n=function(t){if(!l)return e()||m[d]||r(d),t},r=function t(r){return l?null:(d++,v.size>=p?setTimeout(function(){return t(r)},0):m[r]||(v.add(r),m[r]=Promise.resolve(s[r]).then(function(t){return u(t,r,s)}).then(function(t){return f(r)(t)}).then(n).catch(function(t){if(a._FP.errors.count++,t._index=r,y.push(t),a._FP.errors.limit<=0)return c(t),t;if(!(y.length>a._FP.errors.limit))return Promise.resolve().then(function(){return f(r)(t)}).then(n);var e=new g("Error limit "+a._FP.errors.limit+" met/exceeded with "+a._FP.errors.count+" errors.",{errors:y,results:m,ctx:a});Promise.resolve(f(r)(t)).then(function(){return c(e)})}),m[r]))};h<p&&h<s.length;)r(h++)})}))},find:function(t){return d.call(this,t).then(function(t){return t.item})},findIndex:function(t){return d.call(this,t).then(function(t){return t.index})},filter:function(t,n){if(this.steps)return this.addStep("filter",Array.prototype.slice.call(arguments));"function"==typeof t&&(n=t,t=this._FP.promise);return m.call(this,t,function(e,r){return Promise.resolve(n(r)).then(function(t){return t?e.concat([r]):e})},[])},flatMap:function(t,e){if(this.steps)return this.addStep("flatMap",Array.prototype.slice.call(arguments));"function"==typeof t&&(e=t,t=this._FP.promise);return A.resolve(t).map(e).reduce(function(t,e){return t.concat.apply(t,e)},[])},reduce:m},a=e.map,f=e.find,l=e.findIndex,p=e.filter,h=e.flatMap,y=e.reduce;function d(t,e){return this.steps?this.addStep("_find",Array.prototype.slice.call(arguments)):("function"==typeof t&&(e=t,t=this._FP.promise),A.resolve(t).filter(e).then(function(t){return null!=t[0]?{item:t[0],index:t.indexOf(t[0])}:{item:void 0,index:-1}}))}function m(t,s,e){return this.steps?this.addStep("reduce",Array.prototype.slice.call(arguments)):(t="function"==typeof t?(e=s,s=t,this._FP?this._FP.promise:this):A.resolve(t,this),new A(function(o,c){return t.then(function(t){var n=t[Symbol.iterator](),i=0;(function r(t){var e=n.next();if(e.done)return o(t);Promise.all([t,e.value]).then(function(t){var e=t[0],t=t[1];return r(s(e,t,i++))}).catch(c)})(e)})}))}var v,_={all:function(t){return v.resolve(Array.isArray(t)?Promise.all(t):function(e){var i=Object.getOwnPropertyNames(e),t=i.map(function(t){return e[t]});return Promise.all(t).then(function(t){return t.reduce(function(t,e,r){var n=i[r];return Object.assign(((r={})[n]=e,r),t)},{})})}(t))},delay:function(t){return this.steps?this.addStep("delay",Array.prototype.slice.call(arguments)):this&&this._FP?v.resolve(this.then(I(t))):I(t)()},_delay:I},F=_.all,b=_.delay,E=_._delay;function I(r){if(!Number.isInteger(r))throw new P("FP.delay(millisec) requires a numeric arg.");return function(e){return new v(function(t){setTimeout(function(){return t(e)},r)})}}var S,j={tapIf:function(e,r,n){if(this.steps)return this.addStep("tapIf",Array.prototype.slice.call(arguments));1===arguments.length&&(r=e,e=function(t){return t});if(c(this))return this.then(function(t){return O(e,r,n,!0)(t)});return O(e,r,n,!0)},thenIf:function(e,r,n){if(this.steps)return this.addStep("thenIf",Array.prototype.slice.call(arguments));1===arguments.length&&(r=e,e=function(t){return t});if(c(this))return this.then(function(t){return O(e,r,n)(t)});return O(e,r,n)},_thenIf:O},x=j.tapIf,t=j.thenIf,e=j._thenIf;function O(t,r,n,i){return void 0===t&&(t=function(t){return t}),void 0===r&&(r=function(t){return t}),void 0===n&&(n=function(){return null}),void 0===i&&(i=!1),function(e){return S.resolve(t(e)).then(function(t){return(t?r:n)(e)}).then(function(t){return i?e:t})}}var L,_={chain:function(){var t=L.resolve();return t.steps=[],t},chainEnd:function(){var s=this;return function(t){if(!s.steps||s.steps.length<=0)throw new P("No steps defined between .chain() & .chainEnd()");var e=0,r=L.unpack(),n=r.promise,i=r.resolve;for(r.reject;e<s.steps.length;){var o=s.steps[e],c=o[0],o=o[2],n=n[c].apply(n,o);e++}return i(t),n}}},j=_.chain,_=_.chainEnd;function M(t){if(!(this instanceof M))return new M(t);if(1!==arguments.length)throw new Error("FunctionalPromises constructor only accepts 1 callback argument");this._FP={errors:{limit:0,count:0},promise:new Promise(t),concurrencyLimit:4}}return(L=S=v=A=M).prototype.all=F,M.prototype.map=a,M.prototype.find=f,M.prototype.findIndex=l,M.prototype.filter=p,M.prototype.flatMap=h,M.prototype.reduce=y,M.prototype.listen=function(e){for(var t=this,r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];if("string"==typeof n&&(n=[n]),!e[e.addEventListener?"addEventListener":"on"])throw new P("Valid EventEmitter required.");var o=this.chainEnd();return this._FP.destroy=function(){return t._FP.destroyHandles.map(function(t){return t()||!0}).filter(function(t){return t}).length},this._FP.destroyHandles=n.map(function(t){return e[e.addEventListener?"addEventListener":"on"](t,o),function(){return e[e.removeEventListener?"removeEventListener":"off"](t,o)}}),this},M.prototype.tapIf=x,M.prototype.thenIf=t,M.prototype._thenIf=e,M.prototype.delay=b,M.prototype._delay=E,M.prototype.reject=function(t){if(t instanceof Error)return this&&(this._error=t),Promise.reject(t);throw new Error("Reject only accepts a new instance of Error!")},M.all=M.prototype.all,M.thenIf=M.prototype._thenIf,M.delay=function(t){return M.resolve().delay(t)},M.silent=function(t){return M.resolve().silent(t)},M.chain=j,M.prototype.chainEnd=_,M.reject=M.prototype.reject,M.resolve=function(r){return new M(function(t,e){if(r&&s(r.then))return r.then(t).catch(e);t(r)})},M.promisify=function(i){var o=this;return function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new M(function(r,n){return i.call.apply(i,[o].concat(e,[function(t,e){return t?n(t):r(e)}]))})}},M.promisifyAll=function(e){if(e&&Object.getPrototypeOf(e))return Object.getOwnPropertyNames(e).filter(function(t){return"function"==typeof e[t]}).reduce(function(t,e){return/Sync/.test(e)||t[e+"Async"]||(t[e+"Async"]=M.promisify(t[""+e])),t},e);throw new Error("Invalid Argument obj in promisifyAll(obj)")},M.unpack=function(){var r,n;return{promise:new M(function(t,e){r=t,n=e}),resolve:r,reject:n}},M.prototype.addStep=function(t,e){return this.steps&&this.steps.push([t,this,e]),this},M.prototype.concurrency=function(t){return void 0===t&&(t=1/0),this.steps?this.addStep("concurrency",Array.prototype.slice.call(arguments)):(this._FP.concurrencyLimit=t,this)},M.prototype.silent=M.prototype.quiet=function(t){return void 0===t&&(t=1/0),this.steps?this.addStep("quiet",Array.prototype.slice.call(arguments)):(this._FP.errors={count:0,limit:t},this)},M.get=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=(n=u(n)).filter(function(t){return"string"==typeof t}),i=n.find(function(t){return"string"!=typeof t});return i?1===r.length?i[r[0]]:r.reduce(function(t,e){return t[e]=i[e],t},{}):function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return M.get.apply(M,e.concat(n))}},M.prototype.get=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.steps?this.addStep("get",Array.prototype.slice.call(arguments)):this.then?this.then(M.get(e)):M.get.apply(M,e)},M.prototype.set=function(e,r){return this.steps?this.addStep("set",Array.prototype.slice.call(arguments)):this.then(function(t){return"object"==typeof t&&(t[e]=r),t})},M.prototype.catch=function(e){if(this.steps)return this.addStep("catch",Array.prototype.slice.call(arguments));if(2===arguments.length)return this.catchIf.apply(this,arguments);if(!s(e))throw new o("Invalid fn argument for `.catch(fn)`. Must be a function. Currently: "+typeof e);return M.resolve(this._FP.promise.catch(function(t){return e(t)}))},M.prototype.catchIf=function(e,r){if(this.steps)return this.addStep("catchIf",Array.prototype.slice.call(arguments));if(!s(r))throw new o("Invalid fn argument for `.catchIf(condition, fn)`. Must be a function. Currently: "+typeof r);return M.resolve(this._FP.promise.catch(function(t){if(e&&t instanceof e)return r(t);throw t}))},M.prototype.then=function(t){if(this.steps)return this.addStep("then",Array.prototype.slice.call(arguments));if(!s(t))throw new o("Invalid fn argument for `.then(fn)`. Must be a function. Currently: "+typeof t);return M.resolve(this._FP.promise.then(t))},M.prototype.tap=function(e){if(this.steps)return this.addStep("tap",Array.prototype.slice.call(arguments));if(!s(e))throw new o("Invalid fn argument for `.tap(fn)`. Must be a function. Currently: "+typeof e);return M.resolve(this._FP.promise.then(function(t){return e(t),t}))},M});
//# sourceMappingURL=umd.min.js.map
